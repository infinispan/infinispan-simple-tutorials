events {}

http {
    server {
        listen 8080;

        # Frontend App: Infinispan Console
        # Serves the console UI (HTML/JS/CSS) at /infinispan/console/
        # X-Forwarded-Prefix tells the backend the base path of the console
        location /infinispan/console/ {
            proxy_pass http://infinispan:11222/console/;
            proxy_set_header X-Forwarded-Prefix /infinispan;
        }

#        # Optional: override config.js path if you want console and API
#        # in different locations (e.g., "/api/"). Uncomment if needed.
#        location /infinispan/console/config.js {
#             proxy_pass http://infinispan:11222/console/config.js;
#             proxy_set_header X-Forwarded-Prefix /api;
#        }

       # API Requests: all other paths under /infinispan/
       # Forwards requests to the Infinispan backend API
       # - Host header preserved
       # - Authorization header forwarded if provided by the client
       # - Original client IP forwarded via X-Real-IP and X-Forwarded-For
       # - HTTP 1.1 connection used for keep-alive
       location /infinispan/ {
           proxy_pass http://infinispan:11222/;
           proxy_set_header Host $host;
           proxy_set_header Authorization $http_authorization;
           proxy_pass_header Authorization;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_http_version 1.1;
           proxy_set_header Connection "";
       }
    }
}
